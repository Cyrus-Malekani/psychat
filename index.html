<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAuth with Supabase and Google</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

</head>
<body>
    <h1>Welcome to My App</h1>

    <!-- Google OAuth Login Button -->
    <button id="google-login">Login with Google</button>
    <script src="supabase.js" type="module"></script>
    <script>
        
        // Replace these with your actual Supabase and Google OAuth credentials
        const SUPABASE_URL = 'https://mlwjjtayomdkstvpdfdz.supabase.co';
        const GOOGLE_CLIENT_ID = '970622602692-bgf84vbd61tc2vorikh2hao3di5tf07f.apps.googleusercontent.com';

        // Callback URL as specified in your Supabase and Google OAuth configurations
        const CALLBACK_URL = 'https://mlwjjtayomdkstvpdfdz.supabase.co/auth/v1/callback';

        // Initialize Supabase
        const { createClient} = supabase
        supabase = createClient(SUPABASE_URL, { autoRefreshToken: true });
        

        // Event listener for the Google login button
        document.getElementById('google-login').addEventListener('click', async () => {
            // Open the Google OAuth authentication page in a new window
            const authWindow = window.open(`https://accounts.google.com/o/oauth2/auth?response_type=code&redirect_uri=${encodeURIComponent(CALLBACK_URL)}&client_id=${GOOGLE_CLIENT_ID}&scope=profile email openid&access_type=offline`, '_blank', 'width=500,height=600');

            // Listen for messages from the authentication window
            window.addEventListener('message', async (event) => {
                if (event.origin === window.location.origin) {
                    // The authentication window will post a message with the user's credentials
                    const userCredentials = event.data;

                    if (userCredentials) {
                        // Use the user's credentials to sign in or create an account in Supabase
                        const { data, error } = await supabase.auth.signInWithOAuth({
                            provider: 'github'
                        })
                        if (error) {
                            console.error('Error signing in with Google:', error);
                        } else {
                            console.log('Successfully signed in with Google!');
                        }

                        // Close the authentication window
                        authWindow.close();
                    }
                }
            });
        });
    </script>

</body>
</html>
